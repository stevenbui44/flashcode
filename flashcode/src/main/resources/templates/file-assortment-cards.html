<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Assortment Cards</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>		
		:root {
		    --background-color: #f9f7f1;
		    --header-color: #1a2a57;
		    
		    --assortment-background: #ffffff;
		    --card-count-background: #f0f0f0;
		    --assortment-border: #ddd;
		    --ellipsis-color: #333333;
		    
		    --title-color: #000000;
		    --text-primary: #333333;
		    --text-secondary: #666666;
		    --no-description-color: #999999;
		    --search-text-color: #ecf0f1;
		    --no-assortments-text: #333333;
		    
		    --search-input-background: #ffffff;
	        --search-input-text: #333333;
	        --search-input-placeholder: #999999;
	        
	        --button-text: #ffffff;
	        
	        --username-text: #ffffff;
	        --profile-pic-background: #808080;
	        --profile-pic-text: #ffffff;
        	--flashcode-title-color: #ffffff;
		}
		
		.content {
		    flex: 1 0 auto;
		    padding-bottom: 120px; /* Adjust this value to increase/decrease the gap */
		}
	
		body {
		    background-color: var(--background-color);
		    height: 100%;
		    display: flex;
    		flex-direction: column;
		    font-family: 'Work Sans', sans-serif;
		}
		
		.form-group label, h2, p {
		    color: var(--assortment-title-color);
		}
		
		/* The text boxes =  */
		.form-control {
		    background-color: var(--assortment-box-background);
		    color: var(--assortment-description-color);
		}
		
		/* To ensure the placeholder text color matches */
		.form-control::placeholder {
		    color: var(--assortment-description-color);
		    opacity: 0.7;
		}
		
		h1 {
		    color: var(--title-color);
		}
		
		.navbar {
		    background-color: var(--header-color) !important;
		}
		
		.navbar-brand {
		    color: var(--flashcode-title-color) !important;
		}
		
		.nav-item {
		    display: flex;
		    align-items: center;
		}
		
		.nav-item form {
		    margin-left: 15px;
		}
		
		.nav-link {
			color: var(--username-text);
		    text-decoration: none; 
		}
		
		.nav-link:hover .profile-pic {
		    background-color: #666666; /* Darker grey on hover */
		}
		
		.navbar-nav {
		    align-items: center;
		}
		
		.profile-pic {
		    width: 28px;
		    height: 28px;
		    border-radius: 50%;
		    background-color: var(--profile-pic-background);
		    color: var(--profile-pic-text);
		    display: flex;
		    align-items: center;
		    justify-content: center;
		    font-weight: bold;
		    font-size: 12px;
		}
		
	</style>
</head>
<body ng-app="myApp">

	<!-- PART THREE: navbar -->
	<nav class="navbar navbar-expand-md bg-dark navbar-dark">
	    <a class="navbar-brand" th:href="@{/assortments}">FlashCode</a>
	    <div class="collapse navbar-collapse" id="collapsibleNavbar">
	        <ul class="navbar-nav ml-auto">
	            <li class="nav-item dropdown">
	                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	                    <span th:text="${username}" class="mr-2">Username</span>
	                    <div class="profile-pic" th:text="${#strings.substring(username,0,1).toUpperCase()}">U</div>
	                </a>
	                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
	                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#themeModal">Themes</a>
	                    <div class="dropdown-divider"></div>
	                    <a class="dropdown-item text-danger" href="#" data-toggle="modal" data-target="#deleteAccountModal">Delete Account</a>
	                </div>
	            </li>
	            <li class="nav-item">
	                <form th:action="@{/logout}" method="post" class="form-inline">
	                    <button type="submit" class="btn btn-link nav-link">Logout</button>
	                </form>
	            </li>
	        </ul>
	    </div>
	</nav>


	<!-- div to put script and code in any order -->
	<div class="content">
	    
	    <!-- PART TWO: html -->
		<div class="container mt-5" ng-controller="assortmentCardsCtrl">
				
		    <div class="d-flex justify-content-between align-items-center">
                <h1>Cards for Assortment: <span th:text="${assortment.title}"></span></h1>
                <a class="btn btn-primary" ng-href="/assortments/{{ assortment.id }}/study">Study</a>
            </div>
		    <p><span th:text="${assortment.description}"></span></p>
		    
		    <!-- PART 1: Form at the top to create a new card -->
	        <!-- <form ng-submit="addCard()">
	            <div class="form-group">
	                <label for="question">Question:</label>
	                <input type="text" class="form-control" id="question" ng-model="newCard.question" required>
	            </div>
	            <div class="form-group">
	                <label for="approach">Approach:</label>
	                <textarea class="form-control" id="approach" ng-model="newCard.approach" required></textarea>
	            </div>
	            <div class="form-group">
	                <label for="code">Code:</label>
	                <textarea class="form-control" id="code" ng-model="newCard.code" required></textarea>
	            </div>
	            <div class="form-group">
	                <label for="timeComplexity">Time Complexity:</label>
	                <input type="text" class="form-control" id="timeComplexity" ng-model="newCard.timeComplexity" required>
	            </div>
	            <div class="form-group">
	                <label for="spaceComplexity">Space Complexity:</label>
	                <input type="text" class="form-control" id="spaceComplexity" ng-model="newCard.spaceComplexity" required>
	            </div>
	            <button type="submit" class="btn btn-primary">Add Card</button>
	        </form> -->
	        <form ng-submit="addCard()">
			    <div class="form-group">
			        <label for="question">Question:</label>
			        <input type="text" class="form-control" id="question" ng-model="newCard.question" required>
			    </div>
			    <div class="form-group">
			        <label for="approach">Approach:</label>
			        <textarea class="form-control" id="approach" ng-model="newCard.approach" required></textarea>
			    </div>
			    <div class="form-group">
			        <label for="code">Code:</label>
			        <textarea class="form-control" id="code" ng-model="newCard.code" required></textarea>
			    </div>
			    <div class="form-group">
			        <label for="timeComplexity">Time Complexity:</label>
			        <input type="text" class="form-control" id="timeComplexity" ng-model="newCard.timeComplexity" required>
			    </div>
			    <div class="form-group">
			        <label for="spaceComplexity">Space Complexity:</label>
			        <input type="text" class="form-control" id="spaceComplexity" ng-model="newCard.spaceComplexity" required>
			    </div>
			    <button type="submit" class="btn btn-primary">Add Card</button>
			</form>
	        
	        
	        <!-- PART 2: Using ng-repeat to show each card -->
		    <!-- <ul>
		        <li ng-repeat="card in assortment.cards">
		            <h2>{{ card.question }}</h2>
		            <p>Approach:</p>
		            <textarea class="form-control" ng-model="card.approach" ng-blur="updateCard(card)">{{ card.approach }}</textarea>
		            <p>Code:</p>
		            <textarea class="form-control" ng-model="card.code" ng-blur="updateCard(card)">{{ card.code }}</textarea>
		            <p>Time Complexity:</p>
		            <textarea class="form-control" ng-model="card.timeComplexity" ng-blur="updateCard(card)">{{ card.timeComplexity }}</textarea>
		            <p>Space Complexity:</p>
		            <textarea class="form-control" ng-model="card.spaceComplexity" ng-blur="updateCard(card)">{{ card.spaceComplexity }}</textarea>
		            <button class="btn btn-danger" ng-click="deleteCard(card.id)">Delete</button>
		        </li>
		    </ul> -->
		    <ul>
			    <li ng-repeat="card in assortment.cards">
			        <h2>{{ card.question }}</h2>
			        <p>Approach:</p>
			        <textarea class="form-control" ng-model="card.approach" ng-blur="updateCard(card)">{{ card.approach }}</textarea>
			        <p>Code:</p>
			        <textarea class="form-control" ng-model="card.code" ng-blur="updateCard(card)">{{ card.code }}</textarea>
			        <p>Time Complexity:</p>
			        <textarea class="form-control" ng-model="card.timeComplexity" ng-blur="updateCard(card)">{{ card.timeComplexity }}</textarea>
			        <p>Space Complexity:</p>
			        <textarea class="form-control" ng-model="card.spaceComplexity" ng-blur="updateCard(card)">{{ card.spaceComplexity }}</textarea>
			        <button class="btn btn-danger" ng-click="deleteCard(card.id)">Delete</button>
			    </li>
			</ul>
		    
		    <!-- Modal 1: Choose a theme -->
		    <div class="modal fade" id="themeModal" tabindex="-1" role="dialog" aria-labelledby="themeModalLabel" aria-hidden="true">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <h5 class="modal-title" id="themeModalLabel">Choose Theme</h5>
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			                    <span aria-hidden="true">&times;</span>
			                </button>
			            </div>
			            <div class="modal-body">
			                <div class="list-group">
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('default')">
			                        Default
			                        <i class="fas fa-check" ng-show="currentTheme === 'default'"></i>
			                    </button>
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('light')">
			                        Light Mode
			                        <i class="fas fa-check" ng-show="currentTheme === 'light'"></i>
			                    </button>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
			
			
	    </div>
	    
	    
	    <!-- PART ONE: angularjs -->
	    <script>
	        var app = angular.module('myApp', []);
	        app.controller('assortmentCardsCtrl', function($scope, $http, $q, $timeout) {
	            
	        	$scope.reset = function() {
	        		$scope.newCard = {
                        question: '',
                        approach: '',
                        code: '',
                        timeComplexity: '',
                        spaceComplexity: '',
                    };
	        	}
	        	
	        	$scope.assortment = { 
        			id: [[${assortment.id}]], 
        			cards: [] 
	        	};
	        	
	        	
	        	$scope.getCards = function() {
            	    $http.get('/api/v1/assortments/' + $scope.assortment.id)
            	        .then(function(response) {
            	            $scope.assortment.cards = response.data;
            	        }, function(error) {
            	            console.error('Error fetching cards:', error);
            	        });
            	};
            	
            	$scope.getCards();
            	
            	$scope.addCard = function() {
            	    $scope.success = false;
            	    $scope.failure = false;
            	    $http.post('/api/v1/assortments/' + $scope.assortment.id, $scope.newCard)
            	        .then(function(response) {
            	            console.log('Card added successfully');
            	            $scope.reset();
            	            return $scope.getCards();  // Chain the getCards call here
            	        })
            	        .then(function() {
            	            $scope.success = true;
            	        })
            	        .catch(function(rejection) {
            	            console.error('Error adding card:', rejection);
            	            $scope.failure = true;
            	        });
            	};
            	
            	$scope.deleteCard = function(cardId) {  
            		$http.delete('/api/v1/assortments/' + $scope.assortment.id + '/' + cardId)
	                    .then(function(response) {
	                        // Remove the deleted card from the UI
	                        var index = $scope.assortment.cards.findIndex(function(card) {
	                            return card.id === parseInt(cardId);
	                        });
	                        if (index !== -1) {
	                            $scope.assortment.cards.splice(index, 1);
	                        }
	                    }, function(error) {
	                        console.error('Error deleting card:', error);
	                    });
            	};
            	
            	$scope.updateCard = function(card) {
					$http.put('/api/v1/assortments/' + $scope.assortment.id + '/' + card.id, card)
						.then(function(response) {
							console.log('Card updated successfully');
						}, function(error) {
							console.error('Error updating card:', error);
						});
				};
				
				
				// Set the theme
				$scope.currentTheme = localStorage.getItem('theme') || 'default';

			    $scope.setTheme = function(themeName) {
			        setTheme(themeName);
			        $scope.currentTheme = themeName;
			        localStorage.setItem('theme', themeName);
			    };
            	
	        });
	    </script>
    </div>
    <footer class="footer mt-auto py-3">
	    <div class="container text-center">
	        <span class="text-muted">&copy; FlashCode 2024</span>
	    </div>
	</footer>
    <script src="/js/theme.js"></script>
</body>
</html>
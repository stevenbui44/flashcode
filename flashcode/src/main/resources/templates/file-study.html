<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
	<title>Assortment Cards</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>
	
		:root {
	        --background-color: #f9f7f1;
	        --header-color: #1a2a57;
	        --title-color: #000000;
	        --flashcode-title-color: #ffffff;
	        --username-text: #ffffff;
	    }
	
	    body {
	        font-family: 'Work Sans', sans-serif;
	        background-color: var(--background-color);
	    }
	
	    .navbar {
	        background-color: var(--header-color) !important;
	    }
	
	    .navbar-brand {
	        color: var(--flashcode-title-color) !important;
	        font-weight: bold;
	    }
	
	    .nav-link {
	        color: var(--username-text);
	        text-decoration: none;
	    }
	
	    h1 {
	        color: var(--title-color);
	        font-size: 40px;
	        font-weight: bold;
	        margin-bottom: 20px;
	    }
	
	    pre {
	        font-family: 'Source Code Pro', monospace;
	    }
	
	    .btn-primary {
	        background-color: var(--header-color);
	        border-color: var(--header-color);
	    }
	
	    .btn-primary:hover {
	        background-color: color-mix(in srgb, var(--header-color) 80%, white);
	        border-color: color-mix(in srgb, var(--header-color) 80%, white);
	    }
	
	</style>
</head>
<body ng-app="myApp">

	<!-- PART ONE: Header -->
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
	    <a class="navbar-brand" th:href="@{/assortments}">FlashCode</a>
	    <div class="collapse navbar-collapse" id="collapsibleNavbar">
	        <ul class="navbar-nav ml-auto">
	            <li class="nav-item dropdown">
	                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	                    <span th:text="${username}" class="mr-2">Username</span>
	                    <div class="profile-pic" th:text="${#strings.substring(username,0,1).toUpperCase()}">U</div>
	                </a>
	                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
	                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#themeModal">Themes</a>
	                    <div class="dropdown-divider"></div>
	                    <a class="dropdown-item text-danger" href="#" data-toggle="modal" data-target="#deleteAccountModal">Delete Account</a>
	                </div>
	            </li>
	            <li class="nav-item">
	                <form th:action="@{/logout}" method="post" class="form-inline">
	                    <button type="submit" class="btn btn-link nav-link">Logout</button>
	                </form>
	            </li>
	        </ul>
	    </div>
	</nav>

	<!-- PART TWO: HTML code -->
    <div class="container mt-5" ng-controller="studyCtrl">
        <h1>Study Assortment: <span th:text="${assortment.title}"></span></h1>
        
        <!-- 2.1: previous and next buttons -->
        <div class="d-flex justify-content-between mb-3">
            <button class="btn"
                ng-class="{'btn-secondary': currentCardIndex === 0, 'btn-primary': currentCardIndex > 0}"
                ng-click="previousCard()"
                ng-disabled="currentCardIndex === 0">
                Previous
            </button>
            <button class="btn"
                ng-class="{'btn-secondary': currentCardIndex === assortment.cards.length - 1, 'btn-primary': currentCardIndex < assortment.cards.length - 1}"
                ng-click="nextCard()"
                ng-disabled="currentCardIndex === assortment.cards.length - 1">
                Next
            </button>
        </div>
        
        <!-- 2.2: All Cards -->
        <div class="mt-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h2 class="card-title">Question</h2>
                            <p class="card-text">{{ currentCard.question }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-3" >
                        <div class="card-body" ng-click="toggleVisibility('approach')">
                            <h2 class="card-title">Approach</h2>
                            <p class="card-text" ng-if="visible.approach">{{ currentCard.approach }}</p>
                        </div>
                    </div>
                    <div class="card mb-3">
                        <div class="card-body" ng-click="toggleVisibility('code')">
                            <h2 class="card-title">Code</h2>
                            <pre class="card-text" ng-if="visible.code">{{ currentCard.code }}</pre>
                        </div>
                    </div>
                    <div class="card mb-3">
                        <div class="card-body" ng-click="toggleVisibility('timeComplexity')">
                            <h2 class="card-title">Time Complexity</h2>
                            <p class="card-text" ng-if="visible.timeComplexity">{{ currentCard.timeComplexity }}</p>
                        </div>
                    </div>
                    <div class="card mb-3">
                        <div class="card-body" ng-click="toggleVisibility('spaceComplexity')">
                            <h2 class="card-title">Space Complexity</h2>
                            <p class="card-text" ng-if="visible.spaceComplexity">{{ currentCard.spaceComplexity }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2.3: text box area -->
        <div class="mt-4">
            <textarea class="form-control" rows="5" placeholder="Type here..." ng-keydown="handleTab($event)"></textarea>
        </div>
        
        <!-- Modal 1: Choose a theme -->
	    <div class="modal fade" id="themeModal" tabindex="-1" role="dialog" aria-labelledby="themeModalLabel" aria-hidden="true">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="themeModalLabel">Choose Theme</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                    <span aria-hidden="true">&times;</span>
		                </button>
		            </div>
		            <div class="modal-body">
		                <div class="list-group">
		                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('default')">
		                        Default
		                        <i class="fas fa-check" ng-show="currentTheme === 'default'"></i>
		                    </button>
		                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('light')">
		                        Light Mode
		                        <i class="fas fa-check" ng-show="currentTheme === 'light'"></i>
		                    </button>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
		
    </div>

	<!-- PART THREE: Angular JS code -->
    <script>
        var app = angular.module('myApp', []);
        app.controller('studyCtrl', function($scope, $http) {
            $scope.assortment = { 
                id: [[${assortment.id}]], 
                cards: [] 
            };
            $scope.currentCardIndex = 0;
            $scope.visible = {
                    question: false,
                    approach: false,
                    code: false,
                    timeComplexity: false,
                    spaceComplexity: false
                };

            $scope.getCards = function() {
                $http.get('/api/v1/assortments/' + $scope.assortment.id)
                    .then(function(response) {
                        $scope.assortment.cards = response.data;
                        $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
                    }, function(error) {
                        console.error('Error fetching cards:', error);
                    });
            };

            $scope.getCards();

            $scope.previousCard = function() {
                if ($scope.currentCardIndex > 0) {
                    $scope.currentCardIndex--;
                    $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
                    $scope.resetVisibility();
                }
            };

            $scope.nextCard = function() {
                if ($scope.currentCardIndex < $scope.assortment.cards.length - 1) {
                    $scope.currentCardIndex++;
                    $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
                    $scope.resetVisibility();
                }
            };
            
            $scope.resetVisibility = function() {
                $scope.visible = {
                    question: false,
                    approach: false,
                    code: false,
                    timeComplexity: false,
                    spaceComplexity: false
                };
            };
            
            $scope.toggleVisibility = function(section) {
                $scope.visible[section] = !$scope.visible[section];
            };
            
            $scope.handleTab = function(event) {
                var textarea = event.target;
                var start = textarea.selectionStart;
                var end = textarea.selectionEnd;

				// tab
                if (event.key === "Tab") {
                    event.preventDefault();
                    if (event.shiftKey) {
                        // shift tab = go back one tab
                        var currentLineStart = textarea.value.lastIndexOf('\n', start - 1) + 1;
                        if (textarea.value.substring(currentLineStart, currentLineStart + 1) === "\t") {
                            textarea.value = textarea.value.substring(0, currentLineStart) + textarea.value.substring(currentLineStart + 1);
                            textarea.selectionStart = textarea.selectionEnd = start - 1;
                        }
                    } else {
                        // tab: tab forward
                        textarea.value = textarea.value.substring(0, start) + "\t" + textarea.value.substring(end);
                        textarea.selectionStart = textarea.selectionEnd = start + 1;
                    }
                // enter
                } else if (event.keyCode === 13) {
                    event.preventDefault();
                    var currentLine = textarea.value.substring(0, start).split("\n").pop();
                    var indentation = currentLine.match(/^\s*/)[0];
                    textarea.value = textarea.value.substring(0, start) + "\n" + indentation + textarea.value.substring(end);
                    textarea.selectionStart = textarea.selectionEnd = start + 1 + indentation.length;
                }
            };
            
            $scope.currentTheme = localStorage.getItem('theme') || 'default';

		    $scope.setTheme = function(themeName) {
		        setTheme(themeName);
		        $scope.currentTheme = themeName;
		        localStorage.setItem('theme', themeName);
		    };
            
            $scope.getCards();
        });
    </script>
    <footer class="footer mt-auto py-3">
	    <div class="container text-center">
	        <span class="text-muted">&copy; FlashCode 2024</span>
	    </div>
	</footer>
    <script src="/js/theme.js"></script>
</body>
</html>
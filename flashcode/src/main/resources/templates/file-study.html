<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
	<title>Assortment Cards</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>
	
		:root {
	        --background-color: #f9f7f1;
		    --header-color: #1a2a57;
		    
		    --assortment-background: #ffffff;
		    --card-count-background: #f0f0f0;
		    --assortment-border: #ddd;
		    --ellipsis-color: #333333;
		    
		    --title-color: #000000;
		    --text-primary: #333333;
		    --text-secondary: #666666;
		    --no-description-color: #999999;
		    --search-text-color: #ecf0f1;
		    --no-assortments-text: #333333;
		    
		    --search-input-background: #ffffff;
	        --search-input-text: #333333;
	        --search-input-placeholder: #999999;
	        
	        --button-text: #ffffff;
	        
	        --username-text: #ffffff;
	        --profile-pic-background: #808080;
	        --profile-pic-text: #ffffff;
        	--flashcode-title-color: #ffffff;
	    }
	    
	    .assortment-title {
		    font-size: 40px; 
		    font-weight: bold;
		    margin: 0;
		    margin-right: 20px;
		}
		
		.back-arrow {
		    font-size: 24px;
		    color: var(--header-color);
		    text-decoration: none;
		    display: flex;
		    align-items: center;
		    transition: color 0.3s ease;
		}
		
		.back-arrow:hover {
		    color: color-mix(in srgb, var(--header-color) 70%, white);
		    text-decoration: none;
		}
		
		body {
		    background-color: var(--background-color);
		    height: 100%;
		    display: flex;
    		flex-direction: column;
		    font-family: 'Work Sans', sans-serif;
		}
		
		.btn-primary {
	        background-color: var(--header-color);
	        border-color: var(--header-color);
	    }
	
	    .btn-primary:hover {
	        background-color: color-mix(in srgb, var(--header-color) 80%, white);
	        border-color: color-mix(in srgb, var(--header-color) 80%, white);
	    }
	    
	    .btn-warning, .btn-success {
		    padding: 8px 16px;
		    font-size: 14px;
		}
	    
	    .card-count {
		    font-size: 14px;
		    color: #666;
		}
	    
	    .content {
		    flex: 1 0 auto;
		    padding-bottom: 120px; /* Adjust this value to increase/decrease the gap */
		}
		
		.custom-container {
		    width: 100%;
		    max-width: 1200px;
		    margin-right: auto;
		    margin-left: auto;
		    padding-right: 15px;
		    padding-left: 15px;
		    padding-top: 10px;
		}
		
		.form-group label, h2, p {
		    color: var(--assortment-title-color);
		}
	
	    h1 {
		    color: var(--title-color);
		}
	    
	    .header-container {
		    display: flex;
		    justify-content: space-between;
		    align-items: center;
		    margin-bottom: 10px;
		}
		
		/* TODO: remove this if we don't want a header */
		.header-divider {
		    border: 0;
		    border-top: 1px solid #ccc;
		    margin-top: 10px;
		}
		
		.left-header {
		    display: flex;
		    align-items: center;
		    flex-grow: 1;
		}
		
		.mb-4 {
		    margin-bottom: 0rem !important;
		}
		
		.navbar {
		    background-color: var(--header-color) !important;
		}
		
		.navbar-brand {
		    color: var(--flashcode-title-color) !important;
		}
		
		.nav-item {
		    display: flex;
		    align-items: center;
		}
		
		.nav-item form {
		    margin-left: 15px;
		}
		
		.nav-link {
			color: var(--username-text);
		    text-decoration: none; 
		}
		
		.nav-link:hover .profile-pic {
		    background-color: #666666; /* Darker grey on hover */
		}
		
		.navbar-nav {
		    align-items: center;
		}	    
	    
	    .profile-pic {
		    width: 28px;
		    height: 28px;
		    border-radius: 50%;
		    background-color: var(--profile-pic-background);
		    color: var(--profile-pic-text);
		    display: flex;
		    align-items: center;
		    justify-content: center;
		    font-weight: bold;
		    font-size: 12px;
		}

		.right-header {
		    display: flex;
		    flex-direction: column;
		}
		
		.study-buttons {
		    display: flex;
		    align-items: center;
		}
	    
	    .username {
		    font-size: 16px;
		    font-weight: bold;
		    margin-bottom: 5px;
		}
	    
	    .vertical-divider {
		    width: 1px;
		    height: 40px;
		    background-color: #ccc;
		    margin: 20px;
		}
	
	</style>
</head>
<body ng-app="myApp">

	<!-- PART ONE: Header -->
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
	    <a class="navbar-brand" th:href="@{/assortments}">FlashCode</a>
	    <div class="collapse navbar-collapse" id="collapsibleNavbar">
	        <ul class="navbar-nav ml-auto">
	            <li class="nav-item dropdown">
	                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	                    <span th:text="${username}" class="mr-2">Username</span>
	                    <div class="profile-pic" th:text="${#strings.substring(username,0,1).toUpperCase()}">U</div>
	                </a>
	                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
	                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#themeModal">Themes</a>
	                    <div class="dropdown-divider"></div>
	                    <a class="dropdown-item text-danger" href="#" data-toggle="modal" data-target="#deleteAccountModal">Delete Account</a>
	                </div>
	            </li>
	            <li class="nav-item">
	                <form th:action="@{/logout}" method="post" class="form-inline">
	                    <button type="submit" class="btn btn-link nav-link">Logout</button>
	                </form>
	            </li>
	        </ul>
	    </div>
	</nav>


	<div class="content">
	
		<!-- PART TWO: HTML code -->
	    <div class="custom-container mt-5" ng-controller="studyCtrl">
	    
	        <!-- 2.1: Title Header section -->
			<div class="header-container">
			
				<!-- 2.1.1: Title + Username + Number of cards -->
			    <div class="left-header">
			        <a th:href="@{/assortments/{id}(id=${assortment.id})}" class="back-arrow mr-3">
			            <i class="fas fa-arrow-left"></i>
			        </a>
			        <h1 class="assortment-title" th:text="${assortment.title}"></h1>
			        <div class="vertical-divider"></div>
			        <div class="right-header">
			            <div class="username" th:text="${username}"></div>
			            <div class="card-count" ng-if="!studyComplete">
			                Card {{ currentCardIndex + 1 }} of {{ totalCards }}
			            </div>
			            <div class="card-count" ng-if="studyComplete">
			                Study Complete
			            </div>
			        </div>
			    </div>
			    
			    <!-- Still Learning + Know buttons -->
			    <div class="study-buttons" ng-if="!studyComplete">
			    	<button class="btn btn-info mr-2" ng-click="shuffleCards()">
			            <i class="fas fa-random mr-1"></i> Shuffle
			        </button>
			        <button class="btn btn-warning mr-2" ng-click="stillLearning()">
			            Still Learning
			        </button>
			        <button class="btn btn-success" ng-click="know()">
			            Know
			        </button>
			    </div>
			</div>
		    
	        
	        <!-- 2.1: previous and next buttons -->
	        <div ng-if="!studyComplete">
		        
		        <!-- 2.2: All Cards -->
		        <div class="mt-4">
				    <div class="row">
				        <div class="col-md-4">
				            <div class="card mb-3">
				                <div class="card-body">
				                    <h2 class="card-title">Question</h2>
				                    <p class="card-text">{{ currentCard.question }}</p>
				                </div>
				            </div>
				        </div>				        
				        <div class="col-md-4">
				            <div class="card mb-3">
				                <div class="card-body" ng-click="toggleVisibility('code')">
				                    <h2 class="card-title">Code</h2>
				                    <pre class="card-text" ng-if="visible.code">{{ currentCard.code }}</pre>
				                </div>
				            </div>
				            <div class="card mb-3">
				                <div class="card-body" ng-click="toggleVisibility('timeComplexity')">
				                    <h2 class="card-title">Time Complexity</h2>
				                    <p class="card-text" ng-if="visible.timeComplexity">{{ currentCard.timeComplexity }}</p>
				                </div>
				            </div>
				        </div>				        
				        <div class="col-md-4">
				            <div class="card mb-3">
				                <div class="card-body" ng-click="toggleVisibility('approach')">
				                    <h2 class="card-title">Approach</h2>
				                    <p class="card-text" ng-if="visible.approach">{{ currentCard.approach }}</p>
				                </div>
				            </div>
				            <div class="card mb-3">
				                <div class="card-body" ng-click="toggleVisibility('spaceComplexity')">
				                    <h2 class="card-title">Space Complexity</h2>
				                    <p class="card-text" ng-if="visible.spaceComplexity">{{ currentCard.spaceComplexity }}</p>
				                </div>
				            </div>
				        </div>
				    </div>
				</div>
		        
		        
		        <!-- 2.3: text box area -->
		        <div class="mt-4">
		            <textarea class="form-control" rows="5" placeholder="Type here..." ng-keydown="handleTab($event)"></textarea>
		        </div>
		    </div>
	        
	        <!-- 2.4: Show only if at the end of the deck -->
	        <div ng-if="studyComplete" class="text-center mt-5">
		        <h2>Congratulations! You finished reviewing this assortment!</h2>
		        <div class="mt-4">
		            <button class="btn btn-primary mr-2" ng-click="reviewStillLearning()" ng-disabled="!reviewCards.length">Review Still Learning Cards</button>
		            <button class="btn btn-secondary mr-2" ng-click="reviewAllCards()">Review All Cards</button>
		            <a class="btn btn-info" th:href="@{/assortments/{id}(id=${assortment.id})}">Return to Assortment</a>
		        </div>
		    </div>
	        
	        
	        <!-- Modal 1: Choose a theme -->
		    <div class="modal fade" id="themeModal" tabindex="-1" role="dialog" aria-labelledby="themeModalLabel" aria-hidden="true">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <h5 class="modal-title" id="themeModalLabel">Choose Theme</h5>
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			                    <span aria-hidden="true">&times;</span>
			                </button>
			            </div>
			            <div class="modal-body">
			                <div class="list-group">
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('default')">
			                        Default
			                        <i class="fas fa-check" ng-show="currentTheme === 'default'"></i>
			                    </button>
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('light')">
			                        Light Mode
			                        <i class="fas fa-check" ng-show="currentTheme === 'light'"></i>
			                    </button>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
			
	    </div>
	
		<!-- PART THREE: Angular JS code -->
	    <script>
	        var app = angular.module('myApp', []);
	        app.controller('studyCtrl', function($scope, $http) {
	        
	        	
	        	// 3.1: Setting up variables
	        	$scope.assortment = { 
        	        id: [[${assortment.id}]], 
        	        cards: [] 
        	    };
	            
	        	$scope.currentCardIndex = 0;
	            $scope.reviewCards = [];
	            $scope.studyComplete = false;
	            $scope.totalCards = 0;
	            $scope.isReviewingStillLearning = false;
	            
	            $scope.visible = {
                    question: false,
                    approach: false,
                    code: false,
                    timeComplexity: false,
                    spaceComplexity: false
                };
	
	            
	            
	            // 3.2: Get cards
	            $scope.getCards = function() {
	                $http.get('/api/v1/assortments/' + $scope.assortment.id)
	                    .then(function(response) {
	                        $scope.assortment.cards = response.data;
	                        $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                        $scope.totalCards = $scope.assortment.cards.length;
	                    }, function(error) {
	                        console.error('Error fetching cards:', error);
	                    });
	            };
	
	            $scope.getCards();
	
	            
	            
	            // 3.3: Still Learning and Know buttons 
	            $scope.stillLearning = function() {
	                if (!$scope.reviewCards.some(card => card.id === $scope.currentCard.id)) {
	                    $scope.reviewCards.push($scope.currentCard);
	                }
	                $scope.nextCard();
	            };

	            $scope.know = function() {
	            	console.log("know!!");
	                $scope.nextCard();
	            };
	            
	            $scope.nextCard = function() {
	                if ($scope.currentCardIndex < $scope.totalCards - 1) {
	                	console.log("a");
	                    $scope.currentCardIndex++;
	                    $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                    $scope.resetVisibility();
	                } else {
	                	console.log("b");
	                    $scope.studyComplete = true;
	                }
	            };

	            
	            
	            // 3.4: Resetting the screen when on a new card
	            $scope.resetVisibility = function() {
	                $scope.visible = {
	                    question: false,
	                    approach: false,
	                    code: false,
	                    timeComplexity: false,
	                    spaceComplexity: false
	                };
	            };
	            
	            $scope.toggleVisibility = function(section) {
	                $scope.visible[section] = !$scope.visible[section];
	            };
	            
	            
	            
	            // 3.5: Cards when you get to the end of the deck
	            $scope.reviewStillLearning = function() {
	                $scope.assortment.cards = [...$scope.reviewCards];
	                $scope.totalCards = $scope.reviewCards.length;
	                $scope.isReviewingStillLearning = true;
	                $scope.reviewCards = [];
	                $scope.currentCardIndex = 0;
	                $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                $scope.studyComplete = false;
	                $scope.resetVisibility();
	            };

	            $scope.reviewAllCards = function() {
	                $scope.getCards();
	                $scope.isReviewingStillLearning = false;
	                $scope.reviewCards = [];
	                $scope.restartStudy();
	            };

	            $scope.restartStudy = function() {
	                $scope.currentCardIndex = 0;
	                $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                if (!$scope.isReviewingStillLearning) {
	                    $scope.reviewCards = [];
	                    $scope.totalCards = $scope.assortment.cards.length;
	                }
	                $scope.studyComplete = false;
	                $scope.resetVisibility();
	            };
	            
	            
	            
	            // 3.6: Handling tab + indentation in the notes section
	            $scope.handleTab = function(event) {
	                var textarea = event.target;
	                var start = textarea.selectionStart;
	                var end = textarea.selectionEnd;
	
					// tab
	                if (event.key === "Tab") {
	                    event.preventDefault();
	                    if (event.shiftKey) {
	                        // shift tab = go back one tab
	                        var currentLineStart = textarea.value.lastIndexOf('\n', start - 1) + 1;
	                        if (textarea.value.substring(currentLineStart, currentLineStart + 1) === "\t") {
	                            textarea.value = textarea.value.substring(0, currentLineStart) + textarea.value.substring(currentLineStart + 1);
	                            textarea.selectionStart = textarea.selectionEnd = start - 1;
	                        }
	                    } else {
	                        // tab: tab forward
	                        textarea.value = textarea.value.substring(0, start) + "\t" + textarea.value.substring(end);
	                        textarea.selectionStart = textarea.selectionEnd = start + 1;
	                    }
	                // enter
	                } else if (event.keyCode === 13) {
	                    event.preventDefault();
	                    var currentLine = textarea.value.substring(0, start).split("\n").pop();
	                    var indentation = currentLine.match(/^\s*/)[0];
	                    textarea.value = textarea.value.substring(0, start) + "\n" + indentation + textarea.value.substring(end);
	                    textarea.selectionStart = textarea.selectionEnd = start + 1 + indentation.length;
	                }
	            };
	            
	            
	            
	            // 3.7: Themes 
	            $scope.currentTheme = localStorage.getItem('theme') || 'default';
	
			    $scope.setTheme = function(themeName) {
			        setTheme(themeName);
			        $scope.currentTheme = themeName;
			        localStorage.setItem('theme', themeName);
			    };
			    
			    
			    
			    // 3.8: Shuffling cards functionality
			    $scope.shuffleCards = function() {
			        function shuffle(array) {
			            for (let i = array.length - 1; i > 0; i--) {
			                const j = Math.floor(Math.random() * (i + 1));
			                [array[i], array[j]] = [array[j], array[i]];
			            }
			            return array;
			        }

			        $scope.assortment.cards = shuffle($scope.assortment.cards);
			        $scope.currentCardIndex = 0;
			        $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
			        $scope.resetVisibility();
			    };
			    
			    
	            
	            $scope.getCards();
	        });
	    </script>
	</div>
    <footer class="footer mt-auto py-3">
	    <div class="container text-center">
	        <span class="text-muted">&copy; FlashCode 2024</span>
	    </div>
	</footer>
    <script src="/js/theme.js"></script>
</body>
</html>
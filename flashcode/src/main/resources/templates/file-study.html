<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
	<title>Assortment Cards</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>
	
		:root {
	        --background-color: #232124;
		    --header-color: #302D32;
		    
		    --assortment-background: #38353A;
		    --card-count-background: #6c6472;
		    --assortment-border: #0f1122;
		    --ellipsis-color: #B5A9BD;
		    
		    --title-color: #E1E1E1;
		    --text-primary: #E1E1E1;
		    --text-secondary: #B5A9BD;
		    --no-description-color: #E1E1E1;
		    --search-text-color: #E1E1E1;
		    --no-assortments-text: #E1E1E1;
		    
		    --search-input-background: #E1E1E1;
		    --search-input-text: #333333;
		    --search-input-placeholder: #999999;
		    
		    --button-text: #E1E1E1;
		    
		    --username-text: #ffffff;
		    --profile-pic-background: #808080;
		    --profile-pic-text: #ffffff;
		    --flashcode-title-color: #ffffff;
		    
		    --form-control-background: #4E4A50;
		    
		    /* New colors */
		    
		    --card-border-color: rgba(255,255,255,0.125);
		    --progress-bar-background: #4E4A50;
		    --progress-fill-color: #6c6472;
		    --progress-text-color: #E1E1E1;
		    --stat-label-color: #B5A9BD;
		    --stat-value-color: #E1E1E1;
		    --return-link-color: #3498db;
		    --button-primary-color: #3498db;
		    --button-success-color: #2ecc71;
		    --button-warning-color: #f39c12;
		    --button-danger-color: #e74c3c;
		    --card-background-bright: #464248;
		    --button-hover-brightness: 1.3;
		    --text-brightest: #FFFFFF;
		    --button-hover-background: #302D32;
		    
		    --notes-background: #38353A;
		    --notes-text-color: #FFFFFF; 
		    --notes-placeholder-color: #B5A9BD;
	    }
	    
	    .action-buttons {
		    margin-bottom: 2rem;
		    display: flex;
		    flex-direction: center;
		    align-items: center;
		    gap: 10px;
		}
		
		.action-buttons button {
		    margin: 0 0.5rem;
		}
	    
	    .approach-complexity-gap,
		.code-complexity-gap {
		    height: 10px;
		}
		
		.back-arrow {
		    align-items: center;
		    color: var(--header-color);
		    display: flex;
		    font-size: 24px;
		    text-decoration: none;
		    transition: color 0.3s ease;
		    filter: brightness(80%);
		}
		
		.back-arrow:hover {
		    text-decoration: none;
		    background-color: var(--button-hover-background);
		    color: var(--text-brightest);
		    filter: brightness(var(--hover-brightness));
		}
		
		
		body {
		    background-color: var(--background-color);
		    display: flex;
    		flex-direction: column;
		    font-family: 'Work Sans', sans-serif;
		    height: 100%;
		}
		
		
		/* BUTTON 0: All buttons */
		.btn-icon {
		    background: none;
		    border: 0px solid;
		    font-size: 18px;
		    cursor: pointer;
		    padding: 10px;
		    border-radius: 10%;
		    transition: all 0.3s ease;
		    width: 60px;
		    height: 35px;
		    display: flex;
		    align-items: center;
		    justify-content: center;
		    color: var(--button-text);
		}
		.btn-icon:hover {
		    background-color: var(--button-hover-background);
		}
		
		
		/* BUTTON 1: Shuffle button */
		.btn-shuffle {
		    color: var(--button-primary-color);
		    border-color: var(--button-primary-color);
		}
		.btn-shuffle:hover {
		    color: var(--button-primary-color);
		    border-color: var(--button-primary-color);
		    filter: brightness(var(--hover-brightness));
		}
		
		
		/* BUTTON 2: X button */
		.btn-x, .btn-check {
		    width: 60px;
		    height: 35px;
		    font-size: 18px;
		    border: 0px solid;
		    display: flex;
		    align-items: center;
		    justify-content: center;
		}
		.btn-x {
		    color: var(--button-danger-color);
		    border-color: var(--button-danger-color);
		}
		
		.btn-x:hover {
			background-color: rgba(0, 0, 0, 0.1);
			color: var(--button-danger-color);
			filter: brightness(var(--hover-brightness));
			background-color: var(--button-hover-background);
		}
		
		
		/* BUTTON 3: Check button */
		.btn-check {
		    color: var(--button-success-color);
		    border-color: var(--button-success-color);
		}
		.btn-check:hover {
		    background-color: rgba(0, 0, 0, 0.1);
		    color: var(--button-success-color);
		    filter: brightness(var(--hover-brightness));
		    background-color: var(--button-hover-background);
		}
		
		.btn-outline-primary {
		    color: var(--button-primary-color);
		    border-color: var(--button-primary-color);
		}
		
		.btn-outline-primary:hover {
		    background-color: var(--button-primary-color);
		    color: var(--button-text);
		}
		
	    .btn-success,
		.btn-warning {
		    font-size: 14px;
		    padding: 8px 16px;
		}
		
		.card {
		    margin-bottom: 1rem;
		    position: relative;
		    background-color: var(--card-background-bright);
		    border-color: var(--card-border-color);
		    color: var(--text-primary);
		    border: 0px;
		    box-shadow: 0 1px 3px var(--card-shadow-color);  /* Add this line */
		    transition: box-shadow 0.3s ease;
		}
		
		.card-back {
		    align-items: start;
		    backface-visibility: hidden;
		    background-color: var(--card-background);
		    /* border: 1px solid var(--card-border-color);; */
		    border: 0px;
		    border-radius: .25rem;
		    display: flex;
		    height: 100%;
		    justify-content: start;
		    overflow-y: hidden;
		    padding: 10px;
		    position: absolute;
		    transform: rotateY(180deg);
		    transition: transform 0.6s;
		    width: 100%;
		    background-color: var(--card-background-bright);
		    border-color: var(--card-border-color);
		    color: var(--text-primary);
		    
		}
		
		.card-body {
		    align-items: center;
		    cursor: pointer;
		    display: flex;
		    flex-direction: column;
		    height: 100%;
		    justify-content: center;
		    overflow-y: auto;
		    padding: 1rem;
		    position: relative;
		    text-align: center;
		    transform-style: preserve-3d;
		    transition: transform 0.6s;
		    width: 100%;
		}
		
		/* HEIGHT 2 */
		.card-container {
		    cursor: pointer;
		    height: 300px;
		    perspective: 1000px;
		    overflow: hidden;
		    box-shadow: 0 1px 3px var(--card-shadow-color);  /* Add this line */
		    transition: box-shadow 0.3s ease;
		}

		/* HEIGHT 3 */
		.card-container.complexity {
		    height: 100px;
		}
		
		.card-container.flipped .card-back {
		    transform: rotateY(0deg);
		}
		
		.card-container.flipped .card-front {
		    transform: rotateY(180deg);
		}
		
		.card-content {
		    height: 100%;
		    overflow-y: auto;
		    padding: 10px;
		    white-space: pre-wrap;
		    font-size: 14px;
		    color: var(--text-brightest);
		}
		
	    .card-count {
		    font-size: 14px;
		}
		
		.card-front {
		    align-items: center;
		    backface-visibility: hidden;
		    background-color: #fff;
		    /* border: 1px solid rgba(0,0,0,.125); */
		    border-radius: .25rem;
		    display: flex;
		    height: 100%;
		    justify-content: center;
		    overflow-y: hidden;
		    position: absolute;
		    transition: transform 0.6s;
		    width: 100%;
		    background-color: var(--card-background-bright);
		    border-color: var(--card-border-color);
		    color: var(--text-primary);
		}
		
		.card-progress {
		    font-size: 16px;
		    font-weight: bold;
		    text-align: center;
		    flex: 1;
		    color: var(--text-brightest);
		}
		
		.card-text {
		    position: static;
		    height: auto;
		    overflow-y: auto;
		    max-height: 100%;
		    padding: 1rem;
		    box-sizing: border-box;
		    color: var(--text-brightest);
		}
		
		
		.card-text,
		.card-title {
		    backface-visibility: hidden;
		    height: 100%;
		    left: 0;
		    position: absolute;
		    top: 0;
		    width: 100%;
		}
		
		.card-title {
		    display: flex;
		    align-items: center;
		    font-size: 1.4rem;
		    justify-content: center;
		    margin: 0;
		    text-align: center;
		    z-index: 2;
		    color: var(--text-brightest);
		}
		
		.code-card .card-text,
		.code-card pre,
		.approach-card .card-text,
		.complexity-card .card-text {
		    text-align: left;
		    width: 100%;
		}
		
		.code-content {
			font-size: 10px;
			padding-left:15px;
			padding-right:15px;
			tab-size:3;
		}
		
		.completion-subtitle {
		    font-size: 1.5rem;
		    color: var(--text-primary);
		    margin-bottom: 2rem;
		}
		
		.congratulations-title {
		    font-size: 2.5rem;
		    color: var(--text-primary);
		    margin-bottom: 0.5rem;
		}
		
	    .content {
		    flex: 1 0 auto;
		    padding-bottom: 80px; /* Space to the copyright */
		}
		
		.custom-container {
		    margin-left: auto;
		    margin-right: auto;
		    max-width: 1200px;
		    padding-left: 15px;
		    padding-right: 15px;
		    padding-top: 0px;
		    width: 100%;
		}
		
		.form-group label, h2, p {
		    color: var(--assortment-title-color);
		}
	
	    h1 {
		    color: var(--title-color);
		}
	    
	    .header-container {
	    	align-items: center;
		    display: flex;
		    justify-content: space-between;
		    margin-bottom: -15px;
		    margin-top:-30px;
		}
		
		.header-divider {
		    border: 0;
		    border-top: 1px solid #ccc;
		    margin-top: 10px;
		}
		
		.hidden {
		    display: none;
		}
		
		/* .left-header {
			align-items: center;
		    display: flex;
		    flex-grow: 1;
		} */
		
		.left-buttons {
			display: flex;
		    flex: 1;
		    padding-left: 20px;
		    gap: 5px;
		}
		
		.mb-4 {
		    margin-bottom: 0rem !important;
		}
		
		.navbar {
		    background-color: var(--header-color) !important;
		}
		
		.navbar-brand {
		    color: var(--flashcode-title-color) !important;
		}
		
		.navbar-nav {
		    align-items: center;
		}	  
		
		.nav-item {
			align-items: center;
		    display: flex;
		}
		
		.nav-item form {
		    margin-left: 15px;
		}
		
		.nav-link {
			color: var(--username-text);
		    text-decoration: none; 
		}
		
		.nav-link:hover .profile-pic {
		    background-color: #666666; /* Darker grey on hover */
		}  
		
		.notes-label {
		    /* font-weight: bold; */
		    font-size: 14px;
		    font-weight: bold;
		    margin-bottom: 5px;
		    display: block;
		    margin-top: -20px;
		    color: var(--text-brightest);
		}
		
		.notes-textarea {
		    height: 80px;
		    resize: vertical;
		    tab-size: 3;
		    font-size: 14px;
		    background-color: var(--notes-background);
		    color: var(--notes-text-color);
		    border: 1px solid var(--notes-background);
		}
		
		.notes-textarea:focus {
		    background-color: var(--notes-background);
		    color: var(--notes-text-color);
		    outline: none;
		    /* box-shadow: 0 0 0 2px var(--button-primary-color); */
		    box-shadow: none;
		    border: 1px solid var(--notes-background);
		}
		
		pre {
		    white-space: pre-wrap;
		    word-break: break-word;
		}
	    
	    .profile-pic {
		    align-items: center;
		    background-color: var(--profile-pic-background);
		    border-radius: 50%;
		    color: var(--profile-pic-text);
		    display: flex;
		    font-size: 12px;
		    font-weight: bold;
		    height: 28px;
		    justify-content: center;
		    width: 28px;
		}
		
		.progress-bar {
		    width: 100%;
		    height: 30px; /* Increased height to accommodate text */
		    background-color: var(--progress-bar-background);
		    border-radius: 15px;
		    overflow: hidden;
		    position: relative;
		    border: 0px solid #a0a0a0; /* Border to make it pop */
		}
		
		.progress-container {
		    margin-top: 20px;
		    margin-bottom: 60px; /* Added space between the bar and buttons */
		}
		
		.progress-fill {
		    height: 100%;
		    /* background-color: var(--progress-fill-color); */
		    background-color: #4CAF50;
		    transition: width 0.5s ease-in-out;
		}
		
		.progress-text {
		    position: absolute;
		    top: 50%;
		    left: 50%;
		    transform: translate(-50%, -50%);
		    color: var(--progress-text-color);
		    font-weight: bold;
		    
		}
		
		/* HEIGHT 1 */
		.question-card {
		    height: 410px; 
		    overflow-y: auto;
		}
		
		.question-card .card-body {
		    align-items: flex-start;
		    cursor: default;
		    justify-content: flex-start;
		    overflow-y: auto;
		}
		
		.question-card .card-content {
		    align-items: flex-start;
		    justify-content: flex-start;
		}
		
		.question-card .card-text {
		    align-self: flex-start;
		    text-align: left;
		    padding: 1rem;
		    margin-top: 2.5rem;
		}
		
		.question-card .card-title {
		    margin-bottom: 1rem;
		    position: static;
		    transform: none;
		    height: auto;
		}
		
		.restart-button {
		    background-color: transparent;
		    border-color: var(--text-secondary);
		    color: var(--text-secondary);
		    width: 100%;
		    max-width: 300px;
		}
		
		.return-link {
		    text-align: left;
		    margin-top: 20px;
		    padding-left: 20px;
		}
		
		.return-text {
		    /* color: var(--return-link-color); */
		    color: var(--progress-fill-color);
		    text-decoration: none;
		    font-size: 14px;
		}
		
		.return-text:hover {
		    text-decoration: underline;
		    color: var(--progress-fill-hover-color);
		}
		
		.review-button {
		    background-color: var(--progress-fill-color);
		    border-color: var(--progress-fill-color);
		    color: var(--text-brightest);
		    width: 100%;
		    max-width: 300px;
		}
		
		.review-button:hover {
		    background-color: var(--progress-fill-hover-color);
		    border-color: var(--progress-fill-hover-color);
		}
		
		.right-buttons {
		    flex: 1;
		    display: flex;
		    justify-content: flex-end;
		    gap: 5px;
		    padding-right: 20px;
		}
	
		.right-header {
		    display: flex;
		    flex-direction: column;
		}
		
		.row.custom-gutter {
			margin-left: -5px;
		    margin-right: -5px;
		}
		
		.row.custom-gutter > [class^="col-"],
		.row.custom-gutter > [class*=" col-"] {
			padding-left: 5px;
		    padding-right: 5px;
		}
		
		.stats-container {
		    display: flex;
		    justify-content: space-around;
		    margin-bottom: 2rem;
		}
		
		.stat-item {
		    display: flex;
		    flex-direction: column;
		}
		
		.stat-label {
		    font-size: 1rem;
		    color: var(--stat-label-color);
		}
		
		.stat-value {
		    font-size: 1.5rem;
		    font-weight: bold;
		    color: var(--stat-value-color);
		}
		
		/* Ending screen */
		.study-complete-container {
		    text-align: center;
		    padding: 2rem;
		    max-width: 600px;
		    margin: 0 auto;
		    margin-top: -30px;
		}
		
	    
	    .username {
		    font-size: 16px;
		    font-weight: bold;
		    margin-bottom: 5px;
		}
	    
	    .vertical-divider {
		    background-color: #ccc;
		    height: 40px;
		    margin: 20px;
		    width: 1px;
		}
	
	</style>
</head>
<body ng-app="myApp">

	<!-- PART ONE: Header -->
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
	    <a class="navbar-brand" th:href="@{/assortments}">FlashCode</a>
	    <div class="collapse navbar-collapse" id="collapsibleNavbar">
	        <ul class="navbar-nav ml-auto">
	            <li class="nav-item dropdown">
	                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	                    <span th:text="${username}" class="mr-2">Username</span>
	                    <div class="profile-pic" th:text="${#strings.substring(username,0,1).toUpperCase()}">U</div>
	                </a>
	                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
	                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#themeModal">Themes</a>
	                    <div class="dropdown-divider"></div>
	                    <a class="dropdown-item text-danger" href="#" data-toggle="modal" data-target="#deleteAccountModal">Delete Account</a>
	                </div>
	            </li>
	            <li class="nav-item">
	                <form th:action="@{/logout}" method="post" class="form-inline">
	                    <button type="submit" class="btn btn-link nav-link">Logout</button>
	                </form>
	            </li>
	        </ul>
	    </div>
	</nav>


	<div class="content">
	
		<!-- PART TWO: HTML code -->
	    <div class="custom-container mt-5" ng-controller="studyCtrl">
	    
	    	<div ng-if="!studyComplete">
	    	
	        	<!-- 2.1: Title Header section -->
				<div class="header-container">
				
					<!-- 2.1.1: Shuffle button -->
					<div class="left-buttons">
						<a th:href="@{/assortments/{id}(id=${assortment.id})}" class="btn btn-icon back-arrow" title="Back to Assortment">
				            <i class="fas fa-chevron-left"></i>
				        </a>
			            <button class="btn btn-icon btn-shuffle" ng-click="shuffleCards()" title="Shuffle">
			                <i class="fas fa-random"></i>
			            </button>
			        </div>
					
					<!-- 2.1.2: Number of cards -->
				    <div class="card-progress">
			            Card {{ currentCardIndex + 1 }} of {{ totalCards }}
			        </div>
				    
				    <!-- 2.1.3: Still learning + Know buttons -->
				    <div class="right-buttons">
			            <button class="btn btn-icon btn-x" ng-click="stillLearning()" title="Still Learning">
			                <i class="fas fa-times"></i>
			            </button>
			            <button class="btn btn-icon btn-check" ng-click="know()" title="Know">
			                <i class="fas fa-check"></i>
			            </button>
			        </div>
	
				</div>
		    
	        
		        <!-- 2.2: All Cards -->
				<div class="mt-4" ng-if="!studyComplete">
				    <div class="row custom-gutter">
				        <!-- Question Card (no flip) -->
				        <div class="col-md-4">
				            <div class="card question-card">
				                <div class="card-body">
				                    <h2 class="card-title">Question</h2>
				                    <p class="card-text">{{ currentCard.question }}</p>
				                </div>
				            </div>
				        </div>
				        <!-- Code Card -->
				        <div class="col-md-4">
				            <div class="card-container" ng-class="{'flipped': visible.code}" ng-click="toggleVisibility('code')">
				                <div class="card-front">
				                    <h2 class="card-title">See Code</h2>
				                </div>
				                <div class="card-back">
				                    <pre class="card-content code-content"><code>{{ currentCard.code }}</code></pre>
				                </div>
				            </div>
				            <div class="approach-complexity-gap"></div>
				            <div class="card-container complexity" ng-class="{'flipped': visible.timeComplexity}" ng-click="toggleVisibility('timeComplexity')">
				                <div class="card-front">
				                    <h2 class="card-title">Time Complexity</h2>
				                </div>
				                <div class="card-back">
				                    <div class="card-content">{{ currentCard.timeComplexity }}</div>
				                </div>
				            </div>
				        </div>
				        <!-- Approach Card -->
				        <div class="col-md-4">
				            <div class="card-container" ng-class="{'flipped': visible.approach}" ng-click="toggleVisibility('approach')">
				                <div class="card-front">
				                    <h2 class="card-title">See Approach</h2>
				                </div>
				                <div class="card-back">
				                    <div class="card-content">{{ currentCard.approach }}</div>
				                </div>
				            </div>
				            <div class="approach-complexity-gap"></div>
				            <div class="card-container complexity" ng-class="{'flipped': visible.spaceComplexity}" ng-click="toggleVisibility('spaceComplexity')">
				                <div class="card-front">
				                    <h2 class="card-title">Space Complexity</h2>
				                </div>
				                <div class="card-back">
				                    <div class="card-content">{{ currentCard.spaceComplexity }}</div>
				                </div>
				            </div>
				        </div>
				    </div>
				</div>
				
		        
		        <!-- 2.3: text box area -->
		        <div class="mt-4">
				    <label for="notes-textarea" class="notes-label">Notes</label>
				    <textarea id="notes-textarea" class="form-control notes-textarea" rows="4" placeholder="Type here..." ng-keydown="handleTab($event)"></textarea>
				</div>
		    </div>
	        
	        
	        
	        
	        
	        <!-- 2.4: Show only if at the end of the deck -->
	        <div ng-if="studyComplete" class="study-complete-container">
			    <h1 class="congratulations-title">Congratulations!</h1>
			    <h2 class="completion-subtitle">You've finished reviewing this assortment!</h2>
			    
			    <div class="stats-container">
				    <div class="stat-item">
				        <span class="stat-label">Cards Reviewed:</span>
				        <span class="stat-value">{{ isReviewingStillLearning ? currentSessionReviewedCards.length : totalCards }}</span>
				    </div>
				    <div class="stat-item">
				        <span class="stat-label">Cards Known:</span>
				        <span class="stat-value">{{ allTimeKnownCards.length }}</span>
				    </div>
				    <div class="stat-item">
				        <span class="stat-label">Still Learning:</span>
				        <span class="stat-value">{{ allCardsEver - allTimeKnownCards.length }}</span>
				    </div>
				</div>
				
				<div class="progress-container">
				    <div class="progress-bar">
				        <div class="progress-fill" ng-style="{ width: (allTimeKnownCards.length / allCardsEver) * 100 + '%' }"></div>
				        <div class="progress-text">
				            {{ allTimeKnownCards.length }} of {{ allCardsEver }}
				        </div>
				    </div>
				</div>
			
			    <div class="action-buttons">
			        <button class="btn btn-primary review-button" ng-click="reviewStillLearning()" ng-disabled="!reviewCards.length">
			            Review Still Learning Cards
			        </button>
			        <button class="btn btn-outline-secondary restart-button" ng-click="reviewAllCards()">
			            Restart Entire Assortment
			        </button>
			    </div>
			
			    <div class="return-link">
			        <a th:href="@{/assortments/{id}(id=${assortment.id})}" class="return-text">
			            ← Return to assortment
			        </a>
			    </div>
			</div>
		    
		    
	        
	        
	        <!-- Modal 1: Choose a theme -->
		    <div class="modal fade" id="themeModal" tabindex="-1" role="dialog" aria-labelledby="themeModalLabel" aria-hidden="true">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <h5 class="modal-title" id="themeModalLabel">Choose Theme</h5>
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			                    <span aria-hidden="true">&times;</span>
			                </button>
			            </div>
			            <div class="modal-body">
			                <div class="list-group">
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('default')">
			                        Default
			                        <i class="fas fa-check" ng-show="currentTheme === 'default'"></i>
			                    </button>
			                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" ng-click="setTheme('light')">
			                        Light Mode
			                        <i class="fas fa-check" ng-show="currentTheme === 'light'"></i>
			                    </button>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
			
	    </div>
	
		<!-- PART THREE: Angular JS code -->
	    <script>
	        var app = angular.module('myApp', []);
	        app.controller('studyCtrl', function($scope, $http, $timeout) {
	        
	        	
	        	// 3.1: Setting up variables
	        	$scope.assortment = { 
        	        id: [[${assortment.id}]], 
        	        cards: [] 
        	    };
	            
	        	$scope.currentCardIndex = 0;
	            $scope.reviewCards = [];
	            $scope.studyComplete = false;
	            $scope.totalCards = 0;
	            $scope.isReviewingStillLearning = false;
	            $scope.allTimeKnownCards = [];
	            $scope.allCardsEver = 0;
	            
	            $scope.visible = {
                    question: false,
                    approach: false,
                    code: false,
                    timeComplexity: false,
                    spaceComplexity: false
                };
	            
	            $timeout(function() {
	                $scope.initAutoResize();
	            });
	
	            
	            
	            // 3.2: Get cards
	            $scope.getCards = function() {
	                $http.get('/api/v1/assortments/' + $scope.assortment.id)
	                    .then(function(response) {
	                        $scope.assortment.cards = response.data;
	                        $scope.allCardsEver = $scope.assortment.cards.length;
	                        $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                        $scope.totalCards = $scope.assortment.cards.length;
	                        if (!$scope.allTimeKnownCards) {
	                            $scope.allTimeKnownCards = [];
	                        }
	                    }, function(error) {
	                        console.error('Error fetching cards:', error);
	                    });
	            };
	
	            $scope.getCards();
	
	            
	            
	            // 3.3: Still Learning and Know buttons 
	            $scope.stillLearning = function() {
	            	$scope.allTimeKnownCards = $scope.allTimeKnownCards.filter(card => card.id !== $scope.currentCard.id);
	                if (!$scope.reviewCards.some(card => card.id === $scope.currentCard.id)) {
	                    $scope.reviewCards.push($scope.currentCard);
	                }
	                $scope.nextCard();
	            };

	            $scope.know = function() {
	            	console.log("know!!");
	            	if (!$scope.allTimeKnownCards.some(card => card.id === $scope.currentCard.id)) {
	                    $scope.allTimeKnownCards.push($scope.currentCard);
	                }
	                $scope.nextCard();
	            };
	            
	            $scope.nextCard = function() {
	                if ($scope.currentCardIndex < $scope.totalCards - 1) {
	                	console.log("a");
	                    $scope.currentCardIndex++;
	                    $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                    $scope.resetVisibility();
	                    $scope.clearNotes();
	                } else {
	                	console.log("b");
	                    $scope.studyComplete = true;
	                    $scope.clearNotes();
	                    $scope.triggerConfetti();
	                }
	            };

	            
	            
	            // 3.4: Resetting the screen when on a new card
	            $scope.resetVisibility = function() {
	                $scope.visible = {
	                    question: false,
	                    approach: false,
	                    code: false,
	                    timeComplexity: false,
	                    spaceComplexity: false
	                };
	            };
	            
	            $scope.toggleVisibility = function(section) {
	                $scope.visible[section] = !$scope.visible[section];
	                // Add a small delay to allow the flip animation to complete
	                if (!$scope.visible[section]) {
	                    setTimeout(function() {
	                        $scope.$apply(function() {
	                            $scope.resetVisibility();
	                        });
	                    }, 300);
	                }
	            };
	            
	            
	            
	            // 3.5: Cards when you get to the end of the deck
	            $scope.reviewStillLearning = function() {
	            	$scope.currentSessionReviewedCards = [...$scope.reviewCards];
	                $scope.assortment.cards = [...$scope.reviewCards];
	                $scope.totalCards = $scope.reviewCards.length;
	                $scope.isReviewingStillLearning = true;
	                $scope.reviewCards = [];
	                $scope.currentCardIndex = 0;
	                $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                $scope.studyComplete = false;
	                $scope.resetVisibility();
	            };

	            $scope.reviewAllCards = function() {
	                $scope.getCards();
	                $scope.isReviewingStillLearning = false;
	                $scope.reviewCards = [];
	                $scope.currentSessionReviewedCards = [];
	                $scope.restartStudy();
	            };

	            $scope.restartStudy = function() {
	                $scope.currentCardIndex = 0;
	                $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
	                if (!$scope.isReviewingStillLearning) {
	                    $scope.reviewCards = [];
	                    $scope.totalCards = $scope.assortment.cards.length;
	                }
	                $scope.studyComplete = false;
	                $scope.resetVisibility();
	            };
	            
	            
	            
	            // 3.6: Handling tab + indentation in the notes section
	            $scope.handleTab = function(event) {
	                var textarea = event.target;
	                var start = textarea.selectionStart;
	                var end = textarea.selectionEnd;
	
					// tab
	                if (event.key === "Tab") {
	                    event.preventDefault();
	                    if (event.shiftKey) {
	                        // shift tab = go back one tab
	                        var currentLineStart = textarea.value.lastIndexOf('\n', start - 1) + 1;
	                        if (textarea.value.substring(currentLineStart, currentLineStart + 1) === "\t") {
	                            textarea.value = textarea.value.substring(0, currentLineStart) + textarea.value.substring(currentLineStart + 1);
	                            textarea.selectionStart = textarea.selectionEnd = start - 1;
	                        }
	                    } else {
	                        // tab: tab forward
	                        textarea.value = textarea.value.substring(0, start) + "\t" + textarea.value.substring(end);
	                        textarea.selectionStart = textarea.selectionEnd = start + 1;
	                    }
	                // enter
	                } else if (event.keyCode === 13) {
	                    event.preventDefault();
	                    var currentLine = textarea.value.substring(0, start).split("\n").pop();
	                    var indentation = currentLine.match(/^\s*/)[0];
	                    textarea.value = textarea.value.substring(0, start) + "\n" + indentation + textarea.value.substring(end);
	                    textarea.selectionStart = textarea.selectionEnd = start + 1 + indentation.length;
	                }
	            };
	            
	            $scope.initAutoResize = function() {
	                var textarea = document.getElementById('notes-textarea');
	                
	                function autoResize() {
	                    textarea.style.height = 'auto';
	                    textarea.style.height = textarea.scrollHeight + 'px';
	                }

	                textarea.addEventListener('input', autoResize);
	                
	                // Initial call to set the correct height
	                autoResize();
	            };
	            
	            
	            
	            // 3.7: Themes 
	            $scope.currentTheme = localStorage.getItem('theme') || 'default';
	
			    $scope.setTheme = function(themeName) {
			        setTheme(themeName);
			        $scope.currentTheme = themeName;
			        localStorage.setItem('theme', themeName);
			    };
			    
			    
			    
			    // 3.8: Shuffling cards functionality
			    $scope.shuffleCards = function() {
			        function shuffle(array) {
			            for (let i = array.length - 1; i > 0; i--) {
			                const j = Math.floor(Math.random() * (i + 1));
			                [array[i], array[j]] = [array[j], array[i]];
			            }
			            return array;
			        }

			        $scope.assortment.cards = shuffle($scope.assortment.cards);
			        $scope.currentCardIndex = 0;
			        $scope.currentCard = $scope.assortment.cards[$scope.currentCardIndex];
			        $scope.resetVisibility();
			        $scope.clearNotes();
			    };
			    
			    
			    // 3.9: Clear the text area
			    $scope.clearNotes = function() {
			        document.getElementById('notes-textarea').value = '';
			        // If you're using the auto-resize functionality, you might need to trigger it here
			        if ($scope.initAutoResize) {
			            $scope.initAutoResize();
			        }
			    };
			    
			    
			    
			    // 3.10: Confetti lol
			    $scope.triggerConfetti = function() {
				    var end = Date.now() + (3 * 1000);
				
				    /* var colors = ['#bb0000', '#ffffff']; */
				    var colors = ['#ffc107', '#dc3545'];
				
				    (function frame() {
				        confetti({
				            particleCount: 2,
				            angle: 60,
				            spread: 55,
				            origin: { x: 0, y: 0.7 },
				            colors: colors
				        });
				        confetti({
				            particleCount: 2,
				            angle: 120,
				            spread: 55,
				            origin: { x: 1, y: 0.7 },
				            colors: colors
				        });
				
				        if (Date.now() < end) {
				            requestAnimationFrame(frame);
				        }
				    }());
				};
			    
			    
	            
	            $scope.getCards();
	        });
	    </script>
	</div>
    <footer class="footer mt-auto py-3">
	    <div class="container text-center">
	        <span class="text-muted">&copy; FlashCode 2024</span>
	    </div>
	</footer>
    <script src="/js/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</body>
</html>
